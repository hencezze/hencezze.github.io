<p style="text-align: center;"><strong>Recover closed file</strong></p>
<p style="text-align: left;">For first you should to get sure: mounted procfs to /proc and installed in yours VM lsof</p>
<p style="text-align: left;">After you need to find file, whick you are searching: <em><span style="text-decoration: underline;">sudo lsof | grep filename</span></em></p>
<p style="text-align: left;">From this output you should to get 2 variables:</p>
<ol>
<li style="text-align: left;">Number of process (pid)</li>
<li style="text-align: left;">File descriptor (file descriptor)</li>
</ol>
<p>In example: <span style="text-decoration: underline;">kwin&nbsp;<strong>2031(pid)</strong>&nbsp;4002&nbsp;anton&nbsp;<strong>2(file descriptor)</strong>w REG 253,3 4486557 1835028 filename</span></p>
<p>And you copy this variables as a path to file: <em><span style="text-decoration: underline;">sudo cp /proc/2031/fd/2 /home/anton/.xsession-error</span></em></p>
<hr />
<p>Or if you want to get all files, which programm opened and still get opened</p>
<p>sudo lsof | grep filename and take&nbsp;<strong>pid</strong> from this output and grep "deleted" files</p>
<p>Or you may check opened files via this command: <em><span style="text-decoration: underline;">ls -lia /proc/2031/fd/</span></em>, but you still need to know&nbsp;<strong>pid</strong></p>
<p>&nbsp;</p>
<h1 style="text-align: center;"><strong>RunLevels</strong></h1>
<hr />
<p style="text-align: left;">For simple view of runlevels i pick CentOS as a instance OS, because in Ubuntu Runlevels probably worse built then CentOS:&nbsp;</p>
<table style="border-collapse: collapse; width: 100%; height: 144px;" border="1">
<tbody>
<tr style="height: 18px;">
<td style="width: 33.3333%; text-align: center; height: 18px;"><strong>RunLevel</strong></td>
<td style="width: 33.3333%; text-align: center; height: 18px;"><strong>Mode</strong></td>
<td style="width: 33.3333%; text-align: center; height: 18px;"><strong>Action</strong></td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">0</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Shutdown</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Shuts down system</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">1</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Single-User Mode</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Maintainance mode</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">2</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Multi-User Mode</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Not configure network interfaces</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">3</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Multi-User Mode + network</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Start system normally, without GUI</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">4</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">N/A</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Not used</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">5</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">X11</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">As 3 runlevel + GUI</td>
</tr>
<tr style="height: 18px;">
<td style="width: 33.3333%; height: 18px; text-align: center;">6</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Reboot</td>
<td style="width: 33.3333%; height: 18px; text-align: center;">Reboot</td>
</tr>
</tbody>
</table>
<p>While you working with Linux you can switch RunLevels via <strong>telinit</strong> 1/2/3/4/5/6 commands, but you can define default value of runlevel in <strong>/etc/inittab</strong></p>
<p>But nowadays added a new definitions of runlevels:</p>
<ul>
<li>Runlevel 0 = poweroff.target (runlevel0.target)</li>
<li>Runlevel 1 = rescue.target (runlevel1.target)</li>
<li>Runlevel 2 = multi-user.target (runlevel2.target)</li>
<li>Runlevel 3 = multi-user.target (runlevel3.target)</li>
<li>Runlevel 4 = multi-user.target (runlevel4.target)</li>
<li>Runlevel 5 = graphical.target (runlevel5.target)</li>
<li>Runlevel 6 = reboot.target (runlevel6.target)</li>
</ul>
<p>And a new runlevels stored into <strong><span class="pln">ls </span><span class="pun">-</span><span class="pln">l </span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">systemd</span><span class="pun">/</span><span class="pln">system</span><span class="pun">/</span><span class="pln">runlevel</span><span class="pun">*</span></strong><span class="pun">, but it simple symlinks to runlevels 1...6, if yoo want to to switch default runlevel target - exec</span></p>
<pre class="prettyprint"><strong><span class="pln">ln </span><span class="pun">-</span><span class="pln">sf </span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">systemd</span><span class="pun">/</span><span class="pln">system</span><span class="pun">/</span><span class="pln">runlevel3</span><span class="pun">.</span><span class="pln">target </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">systemd</span><span class="pun">/</span><span class="pln">system</span><span class="pun">/</span><span class="kwd">default</span><span class="pun">.</span><span class="pln">target, </span></strong><span class="pln">you just rewrite symlink for default target<br /><br />And if you want to see dependencies of each target you may use</span></pre>
<pre class="prettyprint"><strong><span class="pln">systemctl list</span><span class="pun">-</span><span class="pln">dependencies graphical</span><span class="pun">.</span><span class="pln">target<br /><br /></span></strong><span class="pln">If you want to see on which layer service executing</span></pre>
<pre class="prettyprint"><strong><span class="pln">systemctl show </span><span class="pun">-</span><span class="pln">p </span><span class="typ">WantedBy</span><span class="pln"> sshd</span><span class="pun">.</span><span class="pln">service</span></strong></pre>
<pre class="prettyprint"><strong><span class="pln">&nbsp;</span></strong></pre>
<h1 style="text-align: center;">Cron Jobs/Background Jobs</h1>
<hr />
<p style="text-align: left;">If you want ti shedule a script in Linux, you may use crontab service either via crontab -e or shedule your script in daily, mounthly and etc in crontab file</p>
<ul>
<li style="text-align: left;">Via crontab -e</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; You may manually add job into crontab, for instance 23 59 * * * for exec job every day on 23:59, but you can create a little pipeline like this:</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; <strong>crontab -l &gt; new_script # for backup already existing scheduled jobs</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; echo "0 */12 * * * $k8s_dir/provisioning/get_evicted_pods.sh" &gt;&gt; new_script # schedule a new job</strong><br /><strong>&nbsp; &nbsp; &nbsp; &nbsp; crontab new_script # Add into system cron</strong><br /><strong>&nbsp; &nbsp; &nbsp; &nbsp; rm new_script # deleting unwanted backup</strong></p>
<ul>
<li>&nbsp;Via crontab files</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; sudo vi /etc/corn.daily/basckup for instance. Via this command you will create a "backup" job, which will exec every day</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; If you want troubleshoot some crontab error may use "<strong>grep CRON /var/log/syslog</strong>" for get a simple view about all executed jobs</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; And for fin you able to run all dailys/mounthlys/... jobs via this command "<strong>sudo run-paths /etc/cron.daily/</strong>"</p>

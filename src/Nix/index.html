<h1>About Nix</h1>
<p>Nix is a&nbsp;<em>purely functional package manager</em>. This means that it treats packages like values in purely functional programming languages such as Haskell &mdash; they are built by functions that don&rsquo;t have side-effects, and they never change after they have been built. Nix stores packages in the&nbsp;<em>Nix store</em>, usually the directory&nbsp;<tt>/nix/store</tt>, where each package has its own unique subdirectory such as</p>
<pre class="file-listing"><strong>/nix/store/b6gvzjyb2pg0kjfwrjmg1vfhh54ad73z-firefox-33.1/<br /><br /></strong>where <tt>b6gvzjyb2pg0&hellip;</tt>&nbsp;is a unique identifier for the package that captures all its dependencies (it&rsquo;s a cryptographic hash of the package&rsquo;s build dependency graph). This enables many powerful features.<br /><br /></pre>
<hr />
<h1>Ad hoc shell environments</h1>
<p>Once you have the attribute name for packages, you can start a shell:</p>
<pre><span class="gp">$ </span><em>nix-shell -p gitMinimal vim nano joe
<span class="go">these paths will be fetched (44.16 MiB download, 236.37 MiB unpacked):</span>
<span class="go">...</span>
<span class="go">/nix/store/fsn35pc8njnimgn2sn26dlsyxya1wssb-vim-8.2.0013</span>
<span class="go">/nix/store/wdqjszpr5dlys53d79fym6rv9vyyz29h-joe-4.6</span>
<span class="go">/nix/store/hx63qkip16i4wifaqgxwrrmxj4az53h1-git-2.25.0</span>

<span class="gp">[nix-shell:~]$ </span>git --version
<span class="go">git version 2.25.0</span>

<span class="gp">[nix-shell:~]$ </span>which git
<span class="go">/nix/store/hx63qkip16i4wifaqgxwrrmxj4az53h1-git-2.25.0/bin/git<br /><br /></span></em></pre>
<hr />
<h1>Beyond tooling: Python libraries</h1>
<pre>$ <em>nix-shell -p <span class="s1">'python38.withPackages (packages: [ packages.django ])'<br /></span>  <span class="gp">[nix-shell:~]$ </span>python -c <span class="s1">'import django; print(django)'</span>
<span class="go">  &lt;module 'django' from '/nix/store/c8ipxqsgh8xd6zmwb026lldsgr7hi315-python3-3.8.1-env/lib/python3.8/site-packages/django/__init__.py'&gt;<br /></span></em></pre>
<hr />
<h1 id="serving-a-nix-store-via-http"><span style="color: #333333;">Serving a Nix store via HTTP</span></h1>
<p>You can easily share the Nix store of a machine via HTTP. This allows other machines to fetch store paths from that machine to speed up installations.&nbsp;</p>
<p>The daemon that handles binary cache requests via HTTP,&nbsp;<code class="hljs">nix-serve</code>, is not part of the Nix distribution, but you can install it from Nixpkgs:</p>
<pre><code class="language-console hljs shell"><span class="hljs-meta">$</span><em><span class="bash"> nix-env -iA nixpkgs.nix-serve</span>
</em></code></pre>
<p>You can then start the server, listening for HTTP connections on whatever port you like:</p>
<pre><code class="language-console hljs shell"><span class="hljs-meta">$</span><em><span class="bash"> nix-serve -p 8080</span>
</em></code></pre>
<p>To check whether it works, try the following on the client:</p>
<pre><code class="language-console hljs shell"><span class="hljs-meta">$</span><em><span class="bash"> curl http://avalon:8080/nix-cache-info</span>
</em></code></pre>
<p>which should print something like:</p>
<pre><em><code class="hljs">StoreDir: /nix/store
WantMassQuery: 1
Priority: 30
</code></em></pre>
<p>On the client side, you can tell Nix to use your binary cache using&nbsp;<code class="hljs">--option extra-binary-caches</code>, e.g.:</p>
<pre><code class="language-console hljs shell"><span class="hljs-meta">$</span><span class="bash"> nix-env -iA nixpkgs.firefox --option extra-binary-caches http://avalon:8080/</span>
</code></pre>
<p>The option&nbsp;<code class="hljs">extra-binary-caches</code>&nbsp;tells Nix to use this binary cache in addition to your default caches, such as&nbsp;<a href="https://cache.nixos.org/">https://cache.nixos.org</a>. Thus, for any path in the closure of Firefox, Nix will first check if the path is available on the server&nbsp;<code class="hljs">avalon</code>&nbsp;or another binary caches. If not, it will fall back to building from source.</p>
<p>You can also tell Nix to always use your binary cache by adding a line to the&nbsp;<strong><code class="hljs">nix.conf</code></strong>&nbsp;configuration file like this:</p>
<pre><em><code class="hljs">binary-caches = http://avalon:8080/ <a href="https://cache.nixos.org/">https://cache.nixos.org/</a><br /></code></em></pre>
<hr />
<h1><strong><code class="hljs">Nix-shell</code></strong></h1>
<p>The command&nbsp;<code class="hljs">nix-shell</code>&nbsp;will build the dependencies of the specified derivation, but not the&nbsp;<span>сама деривация</span>. It will then start an interactive shell in which all environment variables defined by the derivation&nbsp;<em>path</em>&nbsp;have been set to their corresponding values, and the script&nbsp;<code class="hljs">$stdenv/setup</code>&nbsp;has been sourced. This is useful for reproducing the environment of a derivation for development.</p>
<p>If&nbsp;<em>path</em>&nbsp;is not given,&nbsp;<code class="hljs">nix-shell</code>&nbsp;defaults to&nbsp;<code class="hljs">shell.nix</code>&nbsp;if it exists, and&nbsp;<code class="hljs">default.nix</code>&nbsp;otherwise.</p>
<p>You can use&nbsp;as a script interpreter to allow scripts written in arbitrary languages to obtain their own dependencies via Nix. This is done by starting the script with the following lines:</p>
<p><em><span class="hljs-meta">#! /usr/bin/env nix-shell</span> </em></p>
<p><em><span class="hljs-comment">#! nix-shell -i real-interpreter -p packages</span></em></p>
<p><span class="hljs-comment">The examples above all used&nbsp;to get dependencies from Nixpkgs. You can also use a Nix expression to build your own dependencies. For example, the Python example could have been written as:</span></p>
<pre><em><code class="language-python hljs"><span class="hljs-comment">#! /usr/bin/env nix-shell</span>
<span class="hljs-comment">#! nix-shell deps.nix -i python</span>
</code></em></pre>
<p><span>where the file&nbsp;in the same directory as the&nbsp;-script contains:</span><code class="hljs">deps.nix</code><code class="hljs">#!</code></p>
<pre><em><code class="language-nix hljs"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

runCommand <span class="hljs-string">"dummy"</span> { <span class="hljs-attr">buildInputs</span> = [ python pythonPackages.prettytable ]; } <span class="hljs-string">""</span></code><br /></em></pre>
<hr />
<p><strong>nix-shell test.nix</strong></p>
<p><em># This imports the nix package collection,</em><br /><em># so we can access the `pkgs` and `stdenv` variables</em><br />with import &lt;nixpkgs&gt; {};</p>
<p><em># Make a new "derivation" that represents our shell</em><br />stdenv.mkDerivation {<br />name = "my-environment";</p>
<p><em># The packages in the `buildInputs` list will be added to the PATH in our shell</em><br />buildInputs = [<br /><em># cowsay is an arbitary package</em><br /><em># see https://nixos.org/nixos/packages.html to search for more</em><br />pkgs.cowsay<br />pkgs.curl<br />];</p>
<p>shellHook = ''<br />echo "Welcome!" | cowsay;<br />ls;<br />export DEGUG=1<br />'';</p>
<p>}</p>
<p>Different way</p>
<div class="mw-highlight mw-content-ltr" dir="ltr">
<pre><span class="p">{</span> stdenv<span class="p">,</span> python <span class="p">}:</span>
stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
  <span class="ss">buildInputs =</span> <span class="p">[</span> python <span class="p">];</span>
  <span class="ss">name =</span> <span class="s2">"some-package"</span><span class="p">;</span>
  <span class="ss">version =</span> <span class="s2">"0.0.1"</span><span class="p">;</span>
  <span class="ss">src =</span> <span class="l">/home/yourname/path/to/project</span><span class="p">;</span> <span class="c1"># can be a local path, or fetchFromGitHub, fetchgit, ...</span>
<span class="p">}</span>
</pre>
</div>
<p>Then you can start a development shell with</p>
<div class="mw-highlight mw-content-ltr" dir="ltr">
<pre>nix-shell -E <span class="s1">'with import &lt;nixpkgs&gt; { }; callPackage ./default.nix { }'</span></pre>
</div>
<pre><em><span class="go">&nbsp;</span></em></pre>
<pre><em><span class="go"><br /><br /></span></em></pre>
<pre class="file-listing">&nbsp;</pre>
